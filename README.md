# quiz_app

Приложение для создания и прохождения квизов на Flutter.

## Использование Firebase

Проект использует **Firebase Firestore** (Cloud Firestore) для хранения данных.

### Структура базы данных

#### Коллекция `quizzes`

**Путь:** `quizzes/{quizId}`

**Запись данных:**

```dart
await _firestore.collection('quizzes').doc(quizId).set({
  'name': quizTitle,              // String
  'questions': questions,         // List<Map<String, dynamic>>
});
```

**Структура данных в Firestore:**

- `name` (String) - название квиза
- `questions` (Array) - массив объектов, где каждый объект содержит:
  - `questionText` (String) - текст вопроса
  - `options` (Array) - массив строк с вариантами ответов
  - `correctAnswerIndexes` (Array) - массив чисел (индексы правильных ответов)

**Чтение данных:**

```dart
final firestoreData = await firestore.collection('quizzes').doc(id).get();
final data = firestoreData.data();                    // Map<String, dynamic>?
final questionsData = data?['questions'] as List<dynamic>;  // List<dynamic>
```

При чтении `questionsData` содержит `List<dynamic>`, где каждый элемент - это `Map<String, dynamic>` с ключами:

- `questionText` → String
- `options` → List (преобразуется в `List<String>` через `QuestionMapper`)
- `correctAnswerIndexes` → List (преобразуется в `List<int>` через `QuestionMapper`)

**Пример реальных данных в Firestore:**

```json
{
  "name": "Тест по программированию",
  "questions": [
    {
      "questionText": "Что такое Flutter?",
      "options": ["Фреймворк", "Язык программирования", "Библиотека"],
      "correctAnswerIndexes": [0]
    }
  ]
}
```

#### Коллекция `shared_results`

**Путь:** `shared_results/{autoGeneratedId}`

**Запись данных:**

```dart
await _firestore.collection('shared_results').add(result.toMap());
```

**Структура данных в Firestore:**

- `quizId` (String) - идентификатор пройденного квиза
- `completionDate` (String) - дата и время в формате ISO8601 (например: "2024-01-15T10:30:00.000Z")
- `userName` (String) - имя пользователя
- `totalQuestions` (Number) - общее количество вопросов (int)
- `correctAnswers` (Number) - количество правильных ответов (int)
- `percentage` (Number) - процент правильных ответов (double)

**Чтение данных:**

```dart
// При чтении completionDate парсится из String в DateTime
DateTime.parse(map['completionDate'])
```

**Пример реальных данных в Firestore:**

```json
{
  "quizId": "quiz123",
  "completionDate": "2024-01-15T10:30:00.000Z",
  "userName": "Иван Иванов",
  "totalQuestions": 10,
  "correctAnswers": 8,
  "percentage": 80.0
}
```

### Операции с базой данных

#### Загрузка квиза

```dart
FirestoreService.uploadQuiz(
  quizId: 'quiz123',
  quizTitle: 'Название квиза',
  questions: [
    {
      'questionText': 'Текст вопроса',
      'options': ['Вариант 1', 'Вариант 2'],
      'correctAnswerIndexes': [0]
    }
  ],
);
```

Использует `.set()` для создания или обновления документа в коллекции `quizzes`.

#### Получение вопросов квиза

```dart
QuestionsRepositoryImpl().getQuestions('quiz123');
```

Использует `.get()` для чтения документа из коллекции `quizzes` по ID. Данные преобразуются через `QuestionMapper.fromJson()`:

- `options` (List<dynamic>) → `List<String>`
- `correctAnswerIndexes` (List<dynamic>) → `List<int>`

#### Сохранение результата

```dart
FirestoreService.saveSharedResult(SharedResult(...));
```

Использует `.add()` для добавления нового документа в коллекцию `shared_results`. `DateTime` преобразуется в ISO8601 строку через `toIso8601String()`.

### Конфигурация

Firebase инициализируется в `main.dart` с использованием `DefaultFirebaseOptions.currentPlatform`, который автоматически определяет конфигурацию для текущей платформы (Android, iOS, Web, macOS, Windows).

Проект ID: `quiz-app-hello-world`
